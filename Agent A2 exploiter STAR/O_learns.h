//--------------------------------------
//   LEARN TO PLAY O
//
//---------------------------------------





//------------------------------------&&&-----------------
void print_inputs_story(void)     //      AQUI SE IMPRIMEN LAS ENTRADAS DE LA RED                                  
{
 int  i,j;
    
              cout << endl; 
              cout << " inputs from story" ;  
              cout << endl; 
              j=0;
              for(i=0;i<N_IN;i++)
                 {
                  cout << Entrada[i];   //              OJO  VECTOR
                  j++;
                  if(j>2) {j=0; cout <<" ";} 
                 }
              cout << endl;       
} 
//-----------------------------------------------
void flash(int pointer)                   //       ---------------->      FLASH   
{
 int i;   
            for(i=0;i<10;i++)   
              {  
               board[pointer]='O';
               plot_game_graphics(); 
               delay(100);               //  100
               board[pointer]='-';
               plot_game_graphics();    
               delay(200);               //  200
               i++;   
              } 
}
//----------------------------------------------
void flash_X(int pointer)                   //       ---------------->      FLASH   
{
 int i;   
            for(i=0;i<10;i++)   
              {  
               board[pointer]='X';
               plot_game_graphics(); 
               delay(100);               //  100
               board[pointer]='-';
               plot_game_graphics();    
               delay(200);               //  200
               i++;   
              } 
}
//---------------------------------------------

void macro_print(void)
{
      plot_game_graphics();  
      //print_game_story();
      //print_inputs_story();    
      //print_play_order();        
      //print_future_targets();   
      print_capa_salida();     
}

//-------------------------------
void busca_neuron_ganador(void)              //                                                                               BUSCA WINNER  !!
{
  int i;
  float max;
               
    net_winner=0;
    //winner_y=0;
    peak_value=0.0;
    max=c_salida.out[0];
    for (i=0; i<N_OUT; i++) counselor_out[i]=0.0;   
    
    for (i=0; i<N_OUT; i++)
        { 
         if (c_salida.out[i]>=max)
           {
            max  = c_salida.out[i];
            net_winner= i;
            peak_value=max;   
           }        
        } 
         // flash(net_winner); 
}
//---------------------------------------
void load_inputs_story(void)                                                                  //  ROI
{
 int   i;
 
    for(i=0;i<N_IN;i++)
          {    
           Entrada[i]=story[story_pointer][i]; //   se carga a la red con una de los muchos tableros guardados en i
          }
} 
//------------------------------------------------------------
void fill_inputs_X(void)   //   convierte ASCII en tablero a sparse en la entrada dela red
{
 int i,j;

 // k=image_in_use;
    //{        
     for(j=0;j<9;j++)
        {
        i=3*j;  
        if(board[j]=='O') {Entrada[i]=0;Entrada[i+1]=0;Entrada[i+2]=1;} // 1 a la derecha para O 
        if(board[j]=='-') {Entrada[i]=0;Entrada[i+1]=1;Entrada[i+2]=0;} // 1 al centro par -  
        if(board[j]=='X') {Entrada[i]=1;Entrada[i+1]=0;Entrada[i+2]=0;} // 1 a la izquierda para X 
        }
    //}    
}  
//--------------------------------------------------------------
void fill_inputs(void) //CARGA TABLERO EN ENTRADA DE RED
{
 int i,j;

 // k=image_in_use;
    //{        
     for(j=0;j<9;j++)
        {
        i=3*j;  
        if(board[j]=='O') {Entrada[i]=0;Entrada[i+1]=0;Entrada[i+2]=1;} // 1 a la derecha para O 
        if(board[j]=='-') {Entrada[i]=0;Entrada[i+1]=1;Entrada[i+2]=0;} // 1 al centro par -  
        if(board[j]=='X') {Entrada[i]=1;Entrada[i+1]=0;Entrada[i+2]=0;} // 1 a la izquierda para X 
        }
    //}    
}
//--------------------------------------------------------------
void set_targets_noise(void)                                  //  ROI
{
 int i;
    
  for(i=0;i<N_OUT;i++) Target[i]=0.0;
  //Target[0]=1.0;   
  //Target[1]=0.0; 
  
} 
//--------------------------------------------------------------
void feed_forward(void)             //LA RED PROCESA 
{
    Gain=0.5;                                                                                                                            //    GAIN   SETTING
    calcular_capa_escondida();
    Gain=1.5;                            
    calcular_capa_salida(); 
    
       
    if(b_flag)
        {
         corregir_pesos_all();
         backpro_count++;
        }
}
//---------------------------------------------
void fire_counselor(void)
{
  int i;
    for(i=0;i<N_OUT;i++)
    {   
      counselor_out[i]= c_salida.out[i]*10.0-0.5; 
      if(counselor_out[i]>1.0) counselor_out[i]=1.0;
      if(counselor_out[i]<0.0) counselor_out[i]=0.0;    
    }
    
}

//-----------------------------------------------------------

//--------------------------------------
void print_console(void)                                    
{
  plot_game_graphics();  
  print_game_story();   
  print_inputs_story();  
  print_play_order_c();       
  print_capa_salida();   
  print_games_won();  
} 
//-------------------------------------
void fill_noise_pattern(void)                                    
{
   int i,j;
   for (i=0; i<9;i++) 
   {
    j=random(4); 
    if(j==0) board[i]='-';
    if(j==1) board[i]='-';
    if(j==2) board[i]='O';       //  O
    if(j==3) board[i]='X';       // X
   }  
   for(i=0;i<N_OUT;i++) Target[i]=0.1;   
} 
//--------------------------------------
/*void count_peak_values(void)                                    
{
 int i;   
  peak_count=0;
  for (i=0; i<9;i++) 
   {
    if(c_salida.out[i]>0.45) peak_count++; 
   }  
}  */
//---------------------------------------

void print_console_stuff(void)                                    
{
   system("cls"); 
   print_future_targets();       
   //print_game_story();  
   print_rotative_key(); 
   print_play_order_c();       
   print_capa_salida();      
   print_games_won(); 
   print_inputs_story();
} 
//-----------------------------------------------
void X_plays_random(void)
{
 int i;       
  do
    { 
     i=random(9);        
     if(board[i]=='-') {
                        board[i]='X';
                        play_order[moves_counter]=i;
                        break;
                       }   
    }   
    while(1);
}
//-------------------------------------------------------------------------
void O_plays_random(void)
{
 int i;       
  do
    { 
     i=random(9);        
     if(board[i]=='-') {
                        board[i]='O';
                        play_order[moves_counter]=i;
                        break;
                       }   
    }   
    while(1);
}
//-----------------------------------------------
void O_plays_clever(void)
{
  fill_inputs(); 
  if(!b_flag) feed_forward();  
  busca_neuron_ganador();    
  if(peak_value>0.45){board[net_winner]='O';}      //  {flash(net_winner);}      
  else O_plays_random();
  
}
//-----------------------------------------------
void X_plays(void)            
{
 X_plays_random();
 fill_inputs(); 
 if(!b_flag) feed_forward();  
 busca_neuron_ganador();   
}
//----------------------------------------------------------------
void X_plays_clever(void)
{
    
  fill_inputs(); 
  feed_forward();  
  busca_neuron_ganador();
  
  if(peak_value>0.45) {if(board[net_winner]=='-') board[net_winner]='X';}
 
  else X_plays_random();
  
}
//-----------------------------------------------------------------
void O_learns(void)
{
 int i;
    
  plot_targets();
  
 
  for(i=0;i<N_OUT;i++) Target[i]=0.0;
      
  for(i=0;i<2;i++)
     {
       story_pointer=moves_counter-2; 
       load_inputs_story();         
       if(b_flag) Target[play_order[moves_counter-1]]=1.0;   
       feed_forward();
       plot_targets();  
       delay(1);   
       if(b_flag)
       {
        fill_noise_pattern();
        fill_inputs();
        Target[play_order[moves_counter-1]]=0.0;    
        feed_forward();  
        plot_targets();  
          
       }
         
       
     }    
        busca_neuron_ganador();
  
  macro_print();
             
         
    // getch();
}
//---------------------------------------------------------------------------------------

//---------------------------------------------------------------------------------------
void O_plays(void)            
{
  float femp1,femp2;   
  //system("cls");
    
  //game_open_case=random(4);  
    
  //O_plays_random();
  O_plays_clever();  
  //fill_inputs(); 
    
  //if(!b_flag) feed_forward();  
           
  //busca_neuron_ganador();

  //Beep(100,1000);     
  femp1= games_won_O;
  femp2= games_played;
    
  winner_record_O= femp1/femp2;  
  
}
//--------------------------------------





//---------------------------------------
/*










*/

